<div class="d-flex align-items-center justify-content-between mb-4 mt-3">
    <h1 class="m-0">Admin</h1>
    <div class="btn-group">
        <a href="@Url.Action("Index", "Pages")" class="btn btn-primary">Website pagina's</a>
        <a href="@Url.Action("Users", "Pages")" class="btn btn-outline-primary">Website users</a>
        <a href="@Url.Action("Settings", "Pages")" class="btn btn-outline-primary">Website instellingen</a>
    </div>
</div>
<div class="container py-4">
<style>
    .table th:nth-child(1),
    .table td:nth-child(1) {
        width: 25%;
    }
    .table th:nth-child(2),
    .table td:nth-child(2) {
        width: 16.67%;
    }
    .table th:nth-child(3),
    .table td:nth-child(3) {
        width: 25%;
    }
    .table th:nth-child(4),
    .table td:nth-child(4) {
        width: 33.33%;
    }
    .table {
        table-layout: fixed;
    }
</style>
<table class="table">
    <thead>
        <tr>
            <th>Pagina Titel</th>
            <th>Menu Item</th>
            <th>Google Titel</th>
            <th>Google Omschrijving</th>
            <th>Acties</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var p in Model)
    {
        <tr class="page-row" data-page-id="@p.Id">
            <td class="view-mode">
                <span class="page-title">@p.Title</span>
            </td>
            <td class="view-mode">
                <span class="page-menu-item">@p.MenuItem</span>
            </td>
            <td class="view-mode">
                <span class="page-google-title">@p.GoogleTitle</span>
            </td>
            <td class="view-mode">
                <span class="page-google-description">@p.GoogleDescription</span>
            </td>
            <td class="view-mode">
                <button class="btn btn-primary btn-sm edit-btn" type="button">Aanpassen</button>
            </td>
        </tr>
        <tr class="edit-mode d-none" data-page-id="@p.Id">
            <form class="page-edit-form" method="post" action="@Url.Action("Edit", new { id = p.Id })" enctype="multipart/form-data">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" value="@p.Id" />
                <input type="hidden" name="Description" value="@p.Description" />
                <td>
                    <input type="text" name="Title" class="form-control form-control-sm" value="@p.Title" />
                </td>
                <td>
                    <input type="text" name="MenuItem" class="form-control form-control-sm" value="@p.MenuItem" />
                </td>
                <td>
                    <input type="text" name="GoogleTitle" class="form-control form-control-sm" value="@p.GoogleTitle" />
                </td>
                <td>
                    <input type="text" name="GoogleDescription" class="form-control form-control-sm" value="@p.GoogleDescription" />
                </td>
                <td>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success btn-sm">Opslaan</button>
                        <button type="button" class="btn btn-secondary btn-sm cancel-btn">Annuleren</button>
                    </div>
                </td>
            </form>
        </tr>
    }
    </tbody>
</table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const editBtns = document.querySelectorAll('.edit-btn');
        const cancelBtns = document.querySelectorAll('.cancel-btn');

        editBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const row = this.closest('.page-row');
                const pageId = row.getAttribute('data-page-id');
                const editRow = document.querySelector(`.edit-mode[data-page-id="${pageId}"]`);
                row.classList.add('d-none');
                editRow.classList.remove('d-none');
            });
        });

        cancelBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const editRow = this.closest('.edit-mode');
                const pageId = editRow.getAttribute('data-page-id');
                const viewRow = document.querySelector(`.page-row[data-page-id="${pageId}"]`);
                editRow.classList.add('d-none');
                viewRow.classList.remove('d-none');
            });
        });

        // AJAX form submission
        const forms = document.querySelectorAll('.page-edit-form');
        forms.forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const formData = new FormData(this);
                const submitBtn = e.submitter || this.querySelector('.btn-success');
                
                if (!submitBtn) {
                    console.error('Submit button not found');
                    this.submit();
                    return;
                }
                
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Opslaan...';

                fetch(this.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        // Update only this specific row
                        const editRow = this.closest('.edit-mode');
                        const pageId = editRow.getAttribute('data-page-id');
                        const viewRow = document.querySelector(`.page-row[data-page-id="${pageId}"]`);
                        
                        if (viewRow) {
                            // Update view row with new values
                            const titleSpan = viewRow.querySelector('.page-title');
                            const menuItemSpan = viewRow.querySelector('.page-menu-item');
                            const googleTitleSpan = viewRow.querySelector('.page-google-title');
                            const googleDescSpan = viewRow.querySelector('.page-google-description');
                            
                            if (titleSpan) titleSpan.textContent = formData.get('Title') || '';
                            if (menuItemSpan) menuItemSpan.textContent = formData.get('MenuItem') || '';
                            if (googleTitleSpan) googleTitleSpan.textContent = formData.get('GoogleTitle') || '';
                            if (googleDescSpan) googleDescSpan.textContent = formData.get('GoogleDescription') || '';
                            
                            // Switch back to view mode for this row only
                            editRow.classList.add('d-none');
                            viewRow.classList.remove('d-none');
                        }
                        
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    } else {
                        throw new Error('Save failed');
                    }
                })
                .catch(error => {
                    alert('Fout bij opslaan. Probeer het opnieuw.');
                    if (submitBtn) {
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    }
                });
            });
        });
    });
</script>